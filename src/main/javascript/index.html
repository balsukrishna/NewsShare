<html>
    <head>
        <title>NewsShare</title>
    </head>
    <style>

		.topicButton,
		.topic {
			padding: 12.5px 25px;
			font-size: 30px;
		 }

		.topicButton {
		    font-weight: bold;			
		 }
		
		.votes,
		.voteButton {
			padding: 5px 5px;
		 }

		.votes {
		    font-weight: bold;			
		 }

	</style>


    <body>
        <form onsubmit="return false;">
            <input id="topicText" class="topic" value="dog">
    	    <button id="topicBtn" class="topicButton" onclick="reload()">submit</button>
        </form>

    	<table id="topTable"  border="1"> </table> 
    </body>

    <script type="text/javascript">
        
        //IO functions 
        
        var socket;
        function connect() {
            socket = new WebSocket("ws://" + window.location.hostname + ":" + window.location.port + "/websocket");
            socket.onmessage = function(event) {
                console.log(event.data);   
            };
        }

        function send(message) {
            //No Socket support ,No Action
            if (!window.WebSocket) { return; }
            if (socket.readyState == WebSocket.OPEN) {
                socket.send(message);
            } else {
                alert("The socket is not yet open.");
            }
        }
        
        //DOM Manipulation
        
        function reload() {
            var json = {};
            for(i = 0; i < 20; i++) {
                  json[genRandText()] = genRandNum();
            }
            
            redraw(json)
        }


        function redraw(topTopics) {
            var topTable    = document.getElementById("topTable");
			while(topTable.rows.length > 0) {
			  topTable.deleteRow(0);
			}
            
            keys = getSortedKeys(topTopics)   
			for(i = 0; i < keys.length; i++) {
				
				var upButton = document.createElement("button");
				upButton.innerHTML = "upvote";
				upButton.className = "voteButton"

				var downButton = document.createElement("button");
				downButton.innerHTML = "downvote";
				downButton.className = "voteButton"

				var votes = document.createElement("span");
				votes.innerHTML = topTopics[keys[i]]
				votes.className = "votes"

				//Create rown and add columns
				var row = topTable.insertRow(i);	
				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);
				var cell4 = row.insertCell(3);

				cell1.appendChild(upButton);	
                cell2.innerHTML = keys[i];    
				cell3.appendChild(votes);
				cell4.appendChild(downButton);
            }
        }
        
        //Util Functions
    
        //Return Random number between 1 and 100
    	function genRandNum() {
			return Math.floor((Math.random() * 100) + 1);
		}
       
        //Returns Random text of length 5 
        function genRandText() {
            var text = "";
            var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
                        
            for (var i = 0; i < 5; i++) {
                text += possible.charAt(Math.floor(Math.random() * possible.length));
            }
            return text; 
        }
        
        //Retun keys sorted according to value
        //All values are expected to be numberic
        //Input: {a: 4,b: 3}
        //Output: [b,a]
		function getSortedKeys(json) {
            var keys = [];
            //Get all keys
            for(var k in json) keys.push(k); 

            //Sort the keys by comparing respective values
            keys.sort(function(a,b){return json[a] - json[b]});
            return keys
        }

    </script>
     

                
</html>
